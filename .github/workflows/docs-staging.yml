name: Docs Staging Preview

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  staging:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Push branch to preview repo
        run: |
          BRANCH="rtd-staging-pr-${{ github.event.pull_request.number }}"
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git remote add preview https://x-access-token:${{ secrets.DOCS_PREVIEW_PAT }}@github.com/cssfrancis/pyxem-docs-staging.git
          git push preview HEAD:$BRANCH --force

      - name: Comment preview link on PR
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: docs-preview
          message: |
            ðŸ“– Your documentation preview is being built!  
            Once ready, you can view it here:  
            https://pyxem-docs-preview.readthedocs.io/en/rtd-staging-pr-${{ github.event.pull_request.number }}/
